<Window x:Class="Frontend.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="http://metro.mahapps.com/winfx/xaml/controls"
        Title="MainWindow"
        Height="500" Width="331"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="#F4F4F4">


    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" Background="#E3E3E3" MouseLeftButtonDown="Widow_MouseLeftButtonDown">
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Right">
                <Button Content="―" 
                        Width="40"
                        BorderBrush="#E3E3E3"
                        Command="{Binding MinimizeCommand}"/>
                <Button Content="❌" 
                        Width="40" 
                        BorderBrush="#E3E3E3"
                        Click="Button_Click"/>
            </StackPanel>
        </Grid>

        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="50"/>
                <RowDefinition Height="350"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <StackPanel Background="Transparent" 
                        Grid.Row="0" 
                        Orientation="Horizontal" 
                        HorizontalAlignment="Left">
                <TextBlock Text="Login" 
                           FontSize="16" 
                           Foreground="Black" 
                           Margin="10"/>
                <Border CornerRadius="4"
                        BorderBrush="Black"
                        BorderThickness="0.5"
                        Background="White"
                        Width="135"
                        Height="30"
                        Margin="5">
                    <TextBox BorderThickness="0"
                             Background="Transparent"
                             Style="{x:Null}"
                             Margin="1"
                             Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"/>
                </Border>
                <Button Content="Connect" 
                        Width="100" 
                        Height="30" 
                        Margin="20 0 0 0" 
                        Background="#E7E7E7"
                        Command="{Binding ConnectCommand}"/>
            </StackPanel>

            <ListView x:Name="MessagesListView"
                      Grid.Row="1"
                      ItemsSource="{Binding Messages}"
                      BorderThickness="0"
                      >

                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="Padding" Value="4"/>
                        <Setter Property="HorizontalContentAlignment" Value="Left"/>
                        <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ListViewItem">
                                    <Border Background="Transparent" Padding="{TemplateBinding Padding}">
                                        <ContentPresenter 
                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" 
                            MaxWidth="250" />
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding ItIsYou}" Value="True">
                                <Setter Property="HorizontalContentAlignment" Value="Right"/>
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ListView.ItemContainerStyle>

                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Border Padding="10" Margin="5" CornerRadius="12" Background="Transparent">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="40"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <Image Grid.Column="0" Width="32" Height="32" Margin="2" Source="{Binding AvatarImage}" />
                                <Border Grid.Column="1"
                                        CornerRadius="10"
                                        Padding="4"
                                        Margin="4,0,0,0">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#E5E5E5"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding ItIsYou}" Value="True">
                                                    <Setter Property="Background" Value="#C8D9E3"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>

                                    <TextBlock Text="{Binding Text}" 
                                       TextWrapping="Wrap"
                                       TextAlignment="Left"
                                       HorizontalAlignment="Stretch"
                                       Foreground="Black"
                                       FlowDirection="LeftToRight" />
                                </Border>

                                <TextBlock Grid.Column="2" 
                                           Text="{Binding TimestampLocal}" 
                                           FontStyle="Italic" 
                                           FontSize="10" 
                                           VerticalAlignment="Bottom" 
                                           Margin="8,0"/>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="FlowDirection" Value="LeftToRight"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding ItIsYou}" Value="True">
                                                <Setter Property="FlowDirection" Value="RightToLeft"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <StackPanel  Grid.Row="2" Orientation="Horizontal">
                <Border CornerRadius="4" 
                    BorderBrush="Black" 
                    BorderThickness="0.5" 
                    Background="White"
                    Width="220"
                    Height="30"
                    Margin="5">
                    <TextBox
                        Margin="2"
                        TextWrapping="Wrap"
                        AcceptsReturn="True"
                        VerticalScrollBarVisibility="Auto"
                        Background="Transparent" 
                        BorderThickness="0"
                        Text="{Binding MessageText, UpdateSourceTrigger=PropertyChanged}" 
                        controls:TextBoxHelper.Watermark="Type message..."
                        Style="{x:Null}"/>
                </Border>
                <Button Content="Send" Width="50" Height="30" Margin="10 0" Background="#E7E7E7"
                        Command="{Binding SendCommand}" />
            </StackPanel>
        </Grid>
    </Grid>
</Window>
